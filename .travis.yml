stages:
  - test
  - build
  - debian

jobs:
  include:
    - stage: test
      go_import_path: nanny
      language: go
      go:
        - "1.x"
      script: 
        - go test -race -coverprofile=coverage.txt -covermode=atomic ./...
      after_success:
        - bash <(curl -s https://codecov.io/bash)
    - stage: build
      go_import_path: nanny
      language: go
      go:
        - "1.x"
      script: 
        - go get github.com/ahmetb/govvv
        - govvv build -pkg nanny/pkg/version
    - stage: debian
      env:
        - TRAVIS_DEBIAN_DISTRIBUTION="sid"
      sudo: required
      language: bash
      services:
        - docker
      before_install:
        - docker pull koalaman/shellcheck:v0.4.7
      script:
        - docker run -v $(pwd):/scripts koalaman/shellcheck /scripts/script.sh
      matrix:
      fast_finish: true